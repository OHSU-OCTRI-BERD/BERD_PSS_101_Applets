---
title: "One Sample T test: Visulization + applet prep"
author: "Will Baker-Robinson"
date: "10/12/2020"
output:
  html_document:
    number_sections: yes
    theme: lumen
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries
library(glue)
library(ggplot2)
library(dplyr)
library(tidyr)

#User defined functions specified in functions.r
source("functions.r")
```

Hypotheses: $H_0: \mu_0 = \mu_A$ vs. $H_A: \mu_0 \ne \mu_A$  
Alpha: This will be a variable that the user can set but default to 0.05   
$\mu_0:$ Population mean under the null hypothesis.  
$\mu_A:$ Anticipated population mean under the alternative hypothesis.  
sigma: Anticipated standard deviation of the population  
$s \in (0, \infty)$
Effect size: $\frac{|\mu_0-\mu_A|}{s}$  
Calculate: Power or Sample size, pick one  
Power: Probability of rejecting the null given the alternative is true. 
$S \in (0,1)$  
Sample size: # of participants required to attain a certain power.  
$n \in \{1,...\}$  

# Hypothesis Distribution Graphs

```{r distribution n & mu0 / muA or dif given}
# Parameters
alpha <- 0.05
mu0 <- 0
muA <- 1 
sd <- 2
pop_sd <- FALSE
effect_size <- abs(mu0 - muA)/sd
power <- NA
N <- 50
df <- N-1
two_sided = TRUE # default
test_stat <- calc_test_stat(df, alpha, two_sided)
ncp <- (muA - mu0) * sqrt(N)/sd
data <- tibble(x_val = seq(from = -3.5*(df/(df-2)), 
                           to = ncp + ifelse(ncp > 4, ncp + 1, 3.5)*(df/(df-2)), 
                           by = 0.01),
               pdf_h0 = dt(x_val, df),
               pdf_hA = dt(x_val, df, ncp)) %>%
   filter(!(x_val < 0 & pdf_h0 < 0.001) & !(x_val > ncp & pdf_hA < 0.001)) # will maybe make slightly more efficient?

# max of pdf_h0 stored here so I don't call it 3x in ggplot fx
max_h0 <- max(data$pdf_h0)

# 1 sample T test power plot w/ sample size given
ggplot(data) + 
  geom_area(mapping = aes(y = ifelse(x_val < -test_stat | x_val > test_stat, pdf_h0, 0),
                          x= x_val, 
                          fill = "Type I Error (alpha)")) +
  geom_area(mapping = aes(y = ifelse(x_val < test_stat, pdf_hA, 0), 
                          x= x_val, 
                          fill = "Type II Error (Beta)")) +
  geom_ribbon(data %>% filter(x_val <= test_stat & x_val >= -test_stat), 
              mapping = aes(ymax = ifelse(pdf_h0 < pdf_hA, pdf_hA, pdf_h0), 
                            ymin = pdf_hA, 
                            x = x_val, 
                            fill = "True Negative")) +
  geom_ribbon(data %>% filter(x_val >= test_stat), 
              mapping = aes(ymin = pdf_h0, 
                            ymax = ifelse(pdf_hA < pdf_h0, pdf_h0, pdf_hA), 
                            x = x_val, 
                            fill = "Power")) +
  geom_ribbon(data %>% filter(x_val <= -test_stat), 
              mapping = aes(ymin = 0, 
                  ymax = pdf_hA, 
                  x = x_val, 
                  fill = "Power")) +
  geom_line(data %>% filter(!(pdf_h0 < 0.001 & x_val > 0)),
            mapping = aes(x = x_val,
                          y = pdf_h0),
            color = "#999999",
            lty = "dashed") +
  geom_segment(aes(x = -test_stat, 
                   y = 0, 
                   xend = -test_stat, 
                   yend = max_h0),
               alpha = 0.7,
               color = "#999999") + 
  geom_segment(aes(x = test_stat, 
                   y = 0, xend = test_stat, 
                   yend = max_h0), 
               alpha = 0.7,
               color = "#999999") + 
  labs(y = "Value of Probability Density Function",
       x = "Value of T statistic",
       title = "Traditional Power Visualization: 1 Sample T-test") +
  annotate("text", x = 0, y = max(data$pdf_h0) + 0.01, label = glue("H0")) +
  annotate("text", x = data[[which.max(data$pdf_hA),1]], y = max(data$pdf_hA) + 0.01, label = glue("HA")) +
  annotate("text", x = -test_stat, y = max_h0 + 0.01, label = glue("-Tcrit")) +
  annotate("text", x = test_stat, y = max_h0 + 0.01, label = glue("+Tcrit")) +
  theme_bw() + # will create my own theme eventually
  scale_fill_manual(name = "Area Represents:", values = c("#0072B2", "#CCCCCC", "#E69F00", "#F0E442")) +
  theme(legend.position="bottom")
```


```{r distribution power & mu0/ muA or dif given}
# Parameters
pow_2_side <- ifelse(two_sided, 1, 2)
alternative <- c("two.sided", "one.sided")
alpha <- 0.05
mu0 <- 0
muA <- 1
sd <- 1
effect_size <- abs(mu0 - muA)/sd
power <- 0.80
N <- ceiling(power.t.test(delta = abs(mu0-muA), sd = sd, sig.level = alpha, power = power, alternative = alternative[pow_2_side])[["n"]])
# solve for N & df then more or less same plot as above

```

# Power Graphs

```{r power graph with dif alpha levels}
pow_2_side <- ifelse(two_sided, 1, 2)
alternative <- c("two.sided", "one.sided")
alpha_presets <- c(0.01, 0.05, 0.10)
alpha <- 0.05
user_power <- power.t.test(N, abs(mu0-muA), sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]]
user_N <- N
if(alpha %in% alpha_presets)
  {
  power_data <- tibble(N = seq(5, N + 5, 1),
                       alpha0.01 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.01, alternative = alternative[pow_2_side])[["power"]],
                       alpha0.05 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.05, alternative = alternative[pow_2_side])[["power"]],
                       alpha0.10 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.10, alternative = alternative[pow_2_side])[["power"]])
  } else
    {
      power_data <- tibble(N = seq(5, N + 5, 1),
                       alpha0.01 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.01, alternative = alternative[pow_2_side])[["power"]],
                       alpha0.05 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.05, alternative = alternative[pow_2_side])[["power"]],
                       alpha0.10 = power.t.test(N, abs(mu0-muA), sd, sig.level = 0.10, alternative = alternative[pow_2_side])[["power"]],
                       user_alpha = power.t.test(N, abs(mu0-muA), sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]]) %>%
      rename(!!paste0("alpha", alpha) := user_alpha)
    }
power_data <- power_data %>%
  pivot_longer(starts_with("alpha"),
               names_prefix = "alpha",
               values_to = "power",
               names_to = "alpha_level") %>%
  # Maybe remove user_alpha? RN just an extra var. May use in future if I want to add a legend for shape.
  mutate(alpha_level = factor(alpha_level),
         user_alpha = ifelse(alpha == alpha_level, TRUE, FALSE))

power_data_non_user <- power_data %>%
  filter(alpha != alpha_level)

power_data_user <- power_data %>%
  filter(alpha == alpha_level)

label_non_user <- power_data_non_user %>%
  group_by(alpha_level) %>%
  summarize(max = max(power))

ggplot() +
   geom_segment(aes(x = user_N,
                   y = 0,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  geom_segment(aes(x = 0,
                   y = user_power,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  # Color for non-user entered
  geom_point(power_data_non_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), color = "#999999", shape = 16) +
  geom_line(power_data_non_user %>% filter, mapping = aes(x = N, y = power, group = alpha_level), color = "#999999") +
  # Color for user entered
  geom_point(power_data_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), shape = 17, color = "#E69F00") +
  geom_line(power_data_user, mapping = aes(x = N, y = power), color = "#E69F00") +
  geom_point(power_data, mapping = aes(x = user_N, y = user_power), color = "#0072B2", shape = 17) +
  geom_text(label_non_user, mapping = aes(x = user_N + 12, y = max, label = alpha_level), color = "#999999") +
  geom_text(power_data_user, mapping = aes(x = user_N + 12, y = max(power), label = alpha_level), color = "#E69F00") +
  theme_bw() +
  labs(x = "Sample Size",
       y = "Power",
       title = "Power Curve: 1 sample T-test by alpha level",
       subtitle = "User specified alpha in orange with (N, power) in blue") +
  theme(legend.position="none")
```

# Power Curve dif effect size

```{r power graph with dif effect sizes}
pow_2_side <- ifelse(two_sided, 1, 2)
alternative <- c("two.sided", "one.sided")
mu0 <- 0
muA <- 0.2
N <- 30
sd <- 1
std_effect <- c(0.2, 0.5, 0.8)
delta_vals <- std_effect*sd
alpha <- 0.05
delta <- abs(mu0-muA)
user_power <- power.t.test(N, delta, sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]]
user_N <- N 
if(delta %in% delta_vals)
  {
  power_data <- tibble(N = seq(5, N + 5, 1),
                       !!paste0("delta", delta_vals[1]) := power.t.test(N, delta_vals[1], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]],
                       !!paste0("delta", delta_vals[2]) := power.t.test(N, delta_vals[2], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]],
                       !!paste0("delta", delta_vals[3]) := power.t.test(N, delta_vals[3], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]])
  } else
    {
      power_data <- tibble(N = seq(5, N + 5, 1),
                       !!paste0("delta", delta_vals[1]) := power.t.test(N, delta_vals[1], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]],
                       !!paste0("delta", delta_vals[2]) := power.t.test(N, delta_vals[2], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]],
                       !!paste0("delta", delta_vals[3]) := power.t.test(N, delta_vals[3], sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]],
                       user_delta = power.t.test(N, delta, sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]]) %>%
      rename(!!paste0("delta", delta) := user_delta)
    }
power_data <- power_data %>%
  pivot_longer(starts_with("delta"),
               names_prefix = "delta",
               names_transform = list("delta_val" = as.double),
               values_to = "power",
               names_to = "delta_val") %>%
  mutate(effect = factor(delta_val/sd))

power_data_non_user <- power_data %>%
  filter(delta != delta_val) %>%
  select(-delta_val)

power_data_user <- power_data %>%
  filter(delta == delta_val) %>%
  select(-delta_val)

label_non_user <- power_data_non_user %>%
  group_by(effect) %>%
  summarize(max = max(power))

ggplot() +
   geom_segment(aes(x = user_N,
                   y = 0,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  geom_segment(aes(x = 0,
                   y = user_power,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  # Color for non-user entered
  geom_point(power_data_non_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), color = "#999999", shape = 16) +
  geom_line(power_data_non_user, mapping = aes(x = N, y = power, group = effect), color = "#999999") +
  # Color for user entered
  geom_point(power_data_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), shape = 17, color = "#E69F00") +
  geom_line(power_data_user, mapping = aes(x = N, y = power), color = "#E69F00") +
  geom_point(power_data, mapping = aes(x = user_N, y = user_power), color = "#0072B2", shape = 17) +
  geom_text(label_non_user, mapping = aes(x = user_N + 6, y = max, label = effect), color = "#999999") +
  geom_text(power_data_user, mapping = aes(x = user_N + 6, y = max(power), label = effect), color = "#E69F00") +
  theme_bw() +
  labs(x = "Sample Size",
       y = "Power",
       title = "Power Curve: 1 sample T-test by effect size",
       subtitle = "User specified effect size in orange with (N, power) in blue") +
  theme(legend.position="none")
```

# Attempt to make power graph by seq of power

```{r base sample on power instead of N}
pow_2_side <- ifelse(two_sided, 1, 2)
alternative <- c("two.sided", "one.sided")
alpha_presets <- c(0.01, 0.05, 0.10)
alpha <- 0.05
user_power <- power.t.test(N, abs(mu0-muA), sd, sig.level = alpha, alternative = alternative[pow_2_side])[["power"]]
user_N <- N
user_delta <- abs(mu0-muA)
if(alpha %in% alpha_presets)
  {
  power_data <- tibble(power_vals = seq(0.10, 0.90, 0.01),
                       alpha0.01 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.01, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]],
                       alpha0.05 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.05, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]],
                       alpha0.10 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.10, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]])
  } else
    {
      power_data <- tibble(power_vals = seq(0.10, 0.90, 0.01),
                       alpha0.01 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.01, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]],
                       alpha0.05 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.05, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]],
                       alpha0.10 = power.t.test(delta = user_delta, 
                                                sd = sd, 
                                                sig.level = 0.10, 
                                                power = power_vals, 
                                                alternative = alternative[pow_2_side])[["n"]],
                       user_alpha = power.t.test(delta = user_delta, 
                                                 sd = sd, 
                                                 sig.level = alpha, 
                                                 power = power_vals, 
                                                 alternative = alternative[pow_2_side])[["n"]]) %>%
      rename(!!paste0("alpha", alpha) := user_alpha)
    }

# DONT FORGET TO APPEND THE USER POWER
power_data <- power_data %>%
  pivot_longer(starts_with("alpha"),
               names_prefix = "alpha",
               values_to = "power",
               names_to = "alpha_level") %>%
  # Maybe remove user_alpha? RN just an extra var. May use in future if I want to add a legend for shape.
  mutate(alpha_level = factor(alpha_level),
         user_alpha = ifelse(alpha == alpha_level, TRUE, FALSE))

power_data_non_user <- power_data %>%
  filter(alpha != alpha_level)

power_data_user <- power_data %>%
  filter(alpha == alpha_level)

label_non_user <- power_data_non_user %>%
  group_by(alpha_level) %>%
  summarize(max = max(power))

ggplot() +
   geom_segment(aes(x = user_N,
                   y = 0,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  geom_segment(aes(x = 0,
                   y = user_power,
                   xend = user_N,
                   yend = user_power),
               alpha = 0.5,
               color = "#0072B2",
               lty = "dashed") + 
  # Color for non-user entered
  geom_point(power_data_non_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), color = "#999999", shape = 16) +
  geom_line(power_data_non_user %>% filter, mapping = aes(x = N, y = power, group = alpha_level), color = "#999999") +
  # Color for user entered
  geom_point(power_data_user %>% filter(N %% 5 == 0), mapping = aes(x = N, y = power), shape = 17, color = "#E69F00") +
  geom_line(power_data_user, mapping = aes(x = N, y = power), color = "#E69F00") +
  geom_point(power_data, mapping = aes(x = user_N, y = user_power), color = "#0072B2", shape = 17) +
  geom_text(label_non_user, mapping = aes(x = user_N + 6, y = max, label = alpha_level), color = "#999999") +
  geom_text(power_data_user, mapping = aes(x = user_N + 6, y = max(power), label = alpha_level), color = "#E69F00") +
  theme_bw() +
  labs(x = "Sample Size",
       y = "Power",
       title = "Power Curve: 1 sample T-test by alpha level",
       subtitle = "User specified alpha in orange with (N, power) in blue") +
  theme(legend.position="none")
```

# T distr one sided power graph

```{r}
alpha <- 0.05
mu0 <- 0
muA <- 0.2 
sd <- 5
pop_sd <- FALSE
effect_size <- abs(mu0 - muA)/sd
power <- NA
N <- 50
df <- N-1
two_sided = FALSE # default
test_stat <- calc_test_stat(df, alpha, two_sided)
ncp <- (muA - mu0) * sqrt(N)/sd
data <- tibble(x_val = seq(from = -3.5*(df/(df-2)), 
                           to = ncp + ifelse(ncp > 4, ncp + 1, 3.5)*(df/(df-2)), 
                           by = 0.01),
               pdf_h0 = dt(x_val, df),
               pdf_hA = dt(x_val, df, ncp)) %>%
   filter(!(x_val < 0 & pdf_h0 < 0.001) & !(x_val > ncp & pdf_hA < 0.001)) # will maybe make slightly more efficient?

# max of pdf_h0 stored here so I don't call it 3x in ggplot fx
max_h0 <- max(data$pdf_h0)

# 1 sample T test power plot w/ sample size given
ggplot(data) + 
  geom_area(mapping = aes(y = ifelse(x_val > test_stat, pdf_h0, 0),
                          x= x_val, 
                          fill = "Type I Error (alpha)")) +
  geom_area(mapping = aes(y = ifelse(x_val < test_stat, pdf_hA, 0), 
                          x= x_val, 
                          fill = "Type II Error (Beta)")) +
  geom_ribbon(data %>% filter(x_val <= test_stat), 
              mapping = aes(ymax = ifelse(pdf_h0 < pdf_hA, pdf_hA, pdf_h0), 
                            ymin = pdf_hA, 
                            x = x_val, 
                            fill = "True Negative")) +
  geom_ribbon(data %>% filter(x_val >= test_stat), 
              mapping = aes(ymin = pdf_h0, 
                            ymax = ifelse(pdf_hA < pdf_h0, pdf_h0, pdf_hA), 
                            x = x_val, 
                            fill = "Power")) +
  geom_line(data %>% filter(!(pdf_h0 < 0.001 & x_val > 0)),
            mapping = aes(x = x_val,
                          y = pdf_h0),
            color = "#999999",
            lty = "dashed") +
  geom_segment(aes(x = test_stat, 
                   y = 0, xend = test_stat, 
                   yend = max_h0), 
               alpha = 0.7,
               color = "#999999") + 
  labs(y = "Value of Probability Density Function",
       x = "Value of T statistic",
       title = "Traditional Power Visualization: 1 Sample T-test") +
  annotate("text", x = 0, y = max(data$pdf_h0) + 0.01, label = glue("H0")) +
  annotate("text", x = data[[which.max(data$pdf_hA),1]], y = max(data$pdf_hA) + 0.01, label = glue("HA")) +
  annotate("text", x = test_stat, y = max_h0 + 0.01, label = glue("+Tcrit")) +
  theme_bw() + # will create my own theme eventually
  scale_fill_manual(name = "Area Represents:", values = c("#0072B2", "#CCCCCC", "#E69F00", "#F0E442")) +
  theme(legend.position="bottom")
```

# Normal one sided power graph

```{r}
alpha <- 0.05
mu0 <- 0
muA <- 1 
sd <- 5
pop_sd <- TRUE
effect_size <- abs(mu0 - muA)/sd
power <- NA
N <- 150
two_sided = FALSE 
test_stat <- qnorm(1 - alpha/1, mean = mu0, sd = sd/sqrt(N))
se <- sd/sqrt(N)
data <- tibble(x_val = seq(from = -3.5*se, 
                           to = muA + 3.5*se, 
                           by = 0.01),
               pdf_h0 = dnorm(x_val, mean = mu0, sd = se),
               pdf_hA = dnorm(x_val, mean = muA, sd = se)) %>%
   filter(!(x_val < 0 & pdf_h0 < 0.001) & !(x_val > muA & pdf_hA < 0.001))
max_h0 <- max(data$pdf_h0)
label_height <- max_h0 + max_h0/50
cols <- c("Type I Error (alpha)" = "#E69F00", "Type II Error (Beta)" = "#F0E442", "Power" = "#0072B2", "True Negative" = "#CCCCCC")

# 1 sample 1 sided normal test power plot w/ sample size given
ggplot(data) + 
  geom_ribbon(data %>% filter(x_val > test_stat),
              mapping = aes(ymax = pdf_h0,
                            ymin = 0,
                            x= x_val,
                            fill = "Type I Error (alpha)")) +
    geom_ribbon(data %>% filter(x_val < test_stat),
              mapping = aes(ymax = pdf_hA,
                            ymin = 0,
                            x= x_val,
                            fill = "Type II Error (Beta)")) +
  geom_ribbon(data %>% filter(x_val <= test_stat), 
              mapping = aes(ymax = ifelse(pdf_h0 < pdf_hA, pdf_hA, pdf_h0), 
                            ymin = pdf_hA, 
                            x = x_val, 
                            fill = "True Negative")) +
  geom_ribbon(data %>% filter(x_val >= test_stat), 
              mapping = aes(ymin = pdf_h0, 
                            ymax = ifelse(pdf_hA < pdf_h0, pdf_h0, pdf_hA), 
                            x = x_val, 
                            fill = "Power")) +
  geom_line(data %>% filter(!(pdf_h0 < 0.001 & x_val > 0)),
            mapping = aes(x = x_val,
                          y = pdf_h0),
            color = "#999999",
            lty = "dashed") +
  geom_segment(aes(x = test_stat, 
                   y = 0, xend = test_stat, 
                   yend = max_h0), 
               alpha = 0.7,
               color = "#999999") + 
  labs(y = "Value of Probability Density Function",
       x = "Value of T statistic",
       title = "Traditional Power Visualization: 1 Sample Z-test") +
  annotate("text", x = 0, y = max(data$pdf_h0) + 0.01, label = glue("H0")) +
  annotate("text", x = data[[which.max(data$pdf_hA),1]], y = max(data$pdf_hA) + 0.01, label = glue("HA")) +
  annotate("text", x = test_stat, y = max_h0 + 0.01, label = glue("Tcrit")) +
  theme_bw() +
  scale_fill_manual(name = "Area Represents:", values = cols) +
  theme(legend.position="bottom")
```

# Normal two-sided 

```{r}
# Parameters
alpha <- 0.05
mu0 <- 0
muA <- 1 
sd <- 2
pop_sd <- FALSE
effect_size <- abs(mu0 - muA)/sd
power <- NA
N <- 50
two_sided = TRUE 
test_stat <- qnorm(1 - alpha/1, mean = mu0, sd = sd/sqrt(N))
se <- sd/sqrt(N)
data <- ata <- tibble(x_val = seq(from = -3.5*se, 
                           to = muA + 3.5*se, 
                           by = 0.01),
               pdf_h0 = dnorm(x_val, mean = mu0, sd = se),
               pdf_hA = dnorm(x_val, mean = muA, sd = se)) %>%
   filter(!(x_val < 0 & pdf_h0 < 0.001) & !(x_val > muA & pdf_hA < 0.001))

max_h0 <- max(data$pdf_h0)
label_height <- max_h0 + max_h0/50
cols <- c("Type I Error (alpha)" = "#E69F00", "Type II Error (Beta)" = "#F0E442", "Power" = "#0072B2", "True Negative" = "#CCCCCC")

# 1 sample T test power plot w/ sample size given
ggplot(data) + 
  geom_ribbon(data %>% filter(x_val < -test_stat),
              mapping = aes(ymax = pdf_h0,
                            ymin = pdf_hA,
                            x= x_val,
                            fill = "Type I Error (alpha)")) +
  geom_ribbon(data %>% filter(x_val > test_stat),
              mapping = aes(ymax = pdf_h0,
                            ymin = 0,
                            x= x_val,
                            fill = "Type I Error (alpha)")) +
  geom_ribbon(data %>% filter(x_val < test_stat),
              mapping = aes(ymax = pdf_hA,
                            ymin = 0,
                            x= x_val,
                            fill = "Type II Error (Beta)")) +
  geom_ribbon(data %>% filter(x_val <= test_stat & x_val >= -test_stat), 
              mapping = aes(ymax = ifelse(pdf_h0 < pdf_hA, pdf_hA, pdf_h0), 
                            ymin = pdf_hA, 
                            x = x_val, 
                            fill = "True Negative")) +
  geom_ribbon(data %>% filter(x_val >= test_stat), 
              mapping = aes(ymin = pdf_h0, 
                            ymax = ifelse(pdf_hA < pdf_h0, pdf_h0, pdf_hA), 
                            x = x_val, 
                            fill = "Power")) +
  geom_ribbon(data %>% filter(x_val <= -test_stat), 
              mapping = aes(ymin = 0, 
                  ymax = pdf_hA, 
                  x = x_val, 
                  fill = "Power")) +
  geom_line(data %>% filter(!(pdf_h0 < 0.001 & x_val > 0)),
            mapping = aes(x = x_val,
                          y = pdf_h0),
            color = "#999999",
            lty = "dashed") +
  geom_segment(aes(x = -test_stat, 
                   y = 0, 
                   xend = -test_stat, 
                   yend = max_h0),
               alpha = 0.7,
               color = "#999999") + 
  geom_segment(aes(x = test_stat, 
                   y = 0,
                   xend = test_stat, 
                   yend = max_h0), 
               alpha = 0.7,
               color = "#999999") + 
  labs(y = "Value of Probability Density Function",
       x = "Value of T statistic",
       title = "Traditional Power Visualization: 1 Sample Z-test") +
  annotate("text", x = 0, y = label_height, label = glue("H0")) +
  annotate("text", x = data[[which.max(data$pdf_hA),1]], y = label_height, label = glue("HA")) +
  annotate("text", x = -test_stat, y = label_height, label = glue("-Tcrit")) +
  annotate("text", x = test_stat, y = label_height, label = glue("+Tcrit")) +
  theme_bw() + # will create my own theme eventually
  scale_fill_manual(name = "Area Represents:", values = cols) +
  theme(legend.position="bottom")
```

