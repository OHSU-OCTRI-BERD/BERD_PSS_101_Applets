---
title: "One Sample T test: Visulization + applet prep"
author: "Will Baker-Robinson"
date: "10/12/2020"
output:
  html_document:
    number_sections: yes
    theme: lumen
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries
library(glue)
library(ggplot2)
library(dplyr)
library(tidyr)

#User defined functions specified in functions.r
source("functions.r")
```

Hypotheses: $H_0: \mu_0 = \mu_A$ vs. $H_A: \mu_0 \ne \mu_A$  
`Do I want to try to include the one-sided hypotheses?`  
Alpha: This will be a variable that the user can set but default to 0.05   
$\mu_0:$ Population mean under the null hypothesis.  
$\mu_A:$ Anticipated population mean under the alternative hypothesis.  
sigma: Anticipated standard deviation of the population  
$s \in (0, \infty)$
Effect size: $\frac{|\mu_0-\mu_A|}{s}$  
Calculate: Power or Sample size, pick one  
Power: Probability of rejecting the null given the alternative is true. 
$S \in (0,1)$  
Sample size: # of participants required to attain a certain power.  
$n \in \{1,...\}$  

```{r Calc power}
# Parameters
alpha <- 0.05
mu0 <- 0
muA <- 0.5 
sd <- 1
effect_size <- abs(mu0 - muA)/sd
power <- NA
N <- 25
df <- N-1
two_sided = TRUE # default
test_stat <- calc_test_stat(df, alpha, two_sided)
ncp <- (muA - mu0) * sqrt(N)/sd
data <- tibble(x_val = seq(from = -3.5*sd, 
                           to = ncp + ifelse(ncp > 3.5, ncp + 1, 3.5)*sd, 
                           by = 0.01),
               pdf_h0 = dt(x_val, df),
               pdf_hA = dt(x_val, df, ncp)) %>%
   filter(!(x_val < 0 & pdf_h0 < 0.001) & !(x_val > ncp & pdf_hA < 0.001)) # will maybe make slightly more efficient?
5
# seems more efficient to call once and store here than call continuously in the ggplot fx
max_hA <- max(data$pdf_hA)

# 1 sample T test power plot w/ sample size given
ggplot(data) +
  geom_area(mapping = aes(y = ifelse(x_val < -test_stat | x_val > test_stat, pdf_h0, 0), 
                          x= x_val, 
                          fill = "Type I Error (alpha)")) +
  geom_area(mapping = aes(y = ifelse(x_val < test_stat, pdf_hA, 0), x= x_val, fill = "Type II Error (Beta)")) +
  geom_ribbon(data %>% filter(x_val <= test_stat & x_val >= -test_stat), 
              mapping = aes(ymax = ifelse(pdf_h0 < pdf_hA, pdf_hA, pdf_h0), 
                            ymin = pdf_hA, 
                            x = x_val, 
                            fill = "True Negative")) +
  geom_ribbon(data %>% filter(x_val >= test_stat), 
              mapping = aes(ymin = pdf_h0, 
                            ymax = ifelse(pdf_hA < pdf_h0, pdf_h0, pdf_hA), 
                            x = x_val, 
                            fill = "True Positive (Power)")) +
  geom_ribbon(data %>% filter(x_val <= -test_stat), 
              mapping = aes(ymin = 0, 
                  ymax = pdf_hA, 
                  x = x_val, 
                  fill = "True Positive (Power)")) +
  geom_segment(aes(x = -test_stat, 
                   y = 0, 
                   xend = -test_stat, 
                   yend = max_hA + 0.03),
               alpha = 0.7) + 
  geom_segment(aes(x = test_stat, 
                   y = 0, xend = test_stat, 
                   yend = max_hA + 0.03), 
               alpha = 0.7) + 
  labs(y = "Value of Probability Density Function",
       x = "Value of T statistic",
       title = "Traditional Power Visualization - 1 Sample T-test") +
  annotate("text", x = 0, y = max(data$pdf_h0) + 0.01, label = glue("H0")) +
  annotate("text", x = data[[which.max(data$pdf_hA),1]], y = max_hA + 0.01, label = glue("HA")) +
  annotate("text", x = -test_stat, y = max_hA + 0.04, label = glue("-Tcrit")) +
  annotate("text", x = test_stat, y = max_hA + 0.04, label = glue("+Tcrit")) +
  theme_bw() + # will create my own theme eventually
  scale_fill_viridis_d(name = "Area Represents:") +
  theme(legend.position="bottom")
```

```{r graph calc power}

```

```{r Calc N}
# Parameters
alpha <- 0.05
mu0 <- 0
muA <- 1
sd <- 1
effect_size <- abs(mu0 - muA)/sd
power <- 0.80
N <- NA
```

```{r graph calc n}

```

```{r power graph}

```

